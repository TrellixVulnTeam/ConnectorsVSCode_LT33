import json
from os import environ, setsid
from paconn.common.util import display

from paconn.operations.json_keys import (
    _PROPERTIES,
    _CONNECTION_PARAMETERS)


def create_connection(powerapps_rp, settings, uuid, connection_params):
    # Just need to creeate connection guid
    # and the payload with the connection parameters
    connector_id = settings.connector_id
    environment = settings.environment

    connection_id = f'/providers/Microsoft.PowerApps/apis/{connector_id}/connections/{uuid}'
    payload = {
        'properties': {
            'connectionParameters': connection_params,
            'environment': {
                'name': environment
            }
        }
    }

    response = powerapps_rp.create_connection(environment, connection_id, payload)
    return response
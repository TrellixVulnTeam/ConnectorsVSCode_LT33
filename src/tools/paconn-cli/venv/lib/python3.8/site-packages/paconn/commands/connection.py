# -----------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for
# license information.
# -----------------------------------------------------------------------------

"""
Connection command.
"""

import json

from paconn import _CONNECTION
from paconn.common.util import display
from paconn.settings.util import load_powerapps_and_flow_rp
from paconn.operations.create_connection import create_connection
from paconn.settings.settingsbuilder import SettingsBuilder


# pylint: disable=too-many-arguments
def connection(
        environment,
        connection_params,
        connector_id,
        connection_id):
    """
    Create command.
    """
    # Get settings
    settings = SettingsBuilder.get_settings(
        environment=environment,
        settings_file=None,
        powerapps_url=None,
        powerapps_version=None,
        api_definition=None,
        icon=None,
        script=None,
        api_properties=None,
        connector_id=connector_id)

    powerapps_rp, _ = load_powerapps_and_flow_rp(
        settings=settings,
        command_context=_CONNECTION)

    # Load connection params file
    connection_parameters = {}
    with open(connection_params) as f:
        connection_parameters = json.load(f)

    connection = create_connection(powerapps_rp, settings, connection_id, connection_parameters)

    display(connection)
